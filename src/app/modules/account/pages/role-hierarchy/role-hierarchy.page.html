<!-- role-hierarchy.page.html -->
<ion-header>
  <app-header [title]="'Role Hierarchy'" [defaultHref]="'../'"></app-header>
</ion-header>

<ion-content>
  <ng-container *ngIf="roleTree$ | async as tree">
    <ng-template
      [ngTemplateOutlet]="recursiveList"
      [ngTemplateOutletContext]="{ nodes: tree }"
    ></ng-template>
  </ng-container>

  <ng-template #recursiveList let-nodes="nodes">
    <ion-list>
      <ng-container *ngFor="let node of nodes">
        <ion-item>
          <ion-label class="ion-text-wrap">
            <h2>{{ node.role.name }}</h2>
            <p>{{ node.role.description }}</p>
            <div *ngIf="node.accounts.length">
              <strong>Accounts:</strong>
              <span *ngFor="let acc of node.accounts; let last = last">
                {{ acc.name || acc.id }}<span *ngIf="!last">, </span>
              </span>
            </div>
          </ion-label>
        </ion-item>
        <ng-container *ngIf="node.children.length">
          <ng-template
            [ngTemplateOutlet]="recursiveList"
            [ngTemplateOutletContext]="{ nodes: node.children }"
          ></ng-template>
        </ng-container>
      </ng-container>
    </ion-list>
  </ng-template>
</ion-content>
