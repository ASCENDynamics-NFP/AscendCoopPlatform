<ion-split-pane contentId="messaging-content" when="md">
  <!-- Master: Chat List (always visible on desktop, full screen on mobile) -->
  <ion-menu
    contentId="messaging-content"
    menuId="chat-list"
    side="start"
    type="push"
  >
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <!-- Main menu button - allows navigation out of messaging on all screen sizes -->
          <ion-menu-button menu="main" color="primary"> </ion-menu-button>
        </ion-buttons>
        <ion-title>{{ 'messaging.title' | translate }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="onNewChat()" fill="clear">
            <ion-icon name="add" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button (click)="showMessagingOptions()" fill="clear">
            <ion-icon name="ellipsis-vertical" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <!-- Chat List -->
      <div class="chat-list-container">
        <!-- Empty state when no chats are available -->
        <div class="empty-state" *ngIf="!hasChats">
          <ion-icon name="chatbubbles-outline" size="large"></ion-icon>
          <h3>{{ 'messaging.no_conversations' | translate }}</h3>
          <p>{{ 'messaging.start_conversation' | translate }}</p>
          <ion-button (click)="onNewChat()" fill="outline">
            <ion-icon name="add" slot="start"></ion-icon>
            <span>{{ 'messaging.new_chat' | translate }}</span>
          </ion-button>
        </div>

        <!-- Actual Chat List when chats exist -->
        <div *ngIf="hasChats">
          <ion-list>
            <ion-item
              *ngFor="let chat of chats$ | async; trackBy: trackByFn"
              button
              (click)="onChatSelected(chat.id)"
              detail="false"
            >
              <!-- Profile Picture -->
              <ion-avatar slot="start">
                <img
                  [src]="getChatAvatarImage(chat) | async"
                  [alt]="(getChatDisplayName(chat) | async) + ' avatar'"
                  onerror="this.src='assets/image/logo/ASCENDynamics NFP-logos_transparent.png'"
                />
              </ion-avatar>

              <!-- Chat Info -->
              <ion-label>
                <h2>{{ getChatDisplayName(chat) | async }}</h2>
                <!-- Removed message preview - only show unread indicator -->
              </ion-label>

              <!-- Timestamp and Unread Badge -->
              <div slot="end" class="chat-meta">
                <p class="timestamp">
                  {{ getFormattedTime(chat.lastMessageTimestamp) }}
                </p>
                <!-- Unread message badge -->
                <ion-badge
                  *ngIf="(getUnreadCount(chat.id) | async) && (getUnreadCount(chat.id) | async)! > 0"
                  color="primary"
                  class="unread-badge"
                >
                  {{ getUnreadCount(chat.id) | async }}
                </ion-badge>
              </div>
            </ion-item>
          </ion-list>
        </div>

        <!-- Message indicating to create a real chat -->
        <div class="info-message" *ngIf="!hasChats">
          <ion-card>
            <ion-card-content>
              <h4>{{ 'messaging.getting_started' | translate }}</h4>
              <p>{{ 'messaging.getting_started_text' | translate }}</p>
              <ol>
                <li>{{ 'messaging.instruction_1' | translate }}</li>
                <li>{{ 'messaging.instruction_2' | translate }}</li>
                <li>{{ 'messaging.instruction_3' | translate }}</li>
              </ol>
              <p>
                <strong>{{ 'messaging.note' | translate }}</strong>
                <span>{{ 'messaging.note_text' | translate }}</span>
              </p>
            </ion-card-content>
          </ion-card>
        </div>
      </div>
    </ion-content>
  </ion-menu>

  <!-- Detail: Chat Window (hidden on mobile when no chat selected) -->
  <ion-router-outlet id="messaging-content" main>
    <!-- Chat content will be loaded here -->
  </ion-router-outlet>
</ion-split-pane>

<!-- Mobile-only: Show placeholder when no chat is selected -->
<!-- Hide this placeholder when we're in any chat-related route -->
<div
  class="no-chat-selected"
  *ngIf="!selectedChatId && isDesktop && !router.url.includes('/messaging/chat') && !router.url.includes('/messaging/new-chat')"
>
  <ion-icon name="chatbubbles-outline" size="large"></ion-icon>
  <h2>{{ 'messaging.select_conversation' | translate }}</h2>
  <p>{{ 'messaging.choose_chat' | translate }}</p>
</div>
