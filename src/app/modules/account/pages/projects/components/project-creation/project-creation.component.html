<!--
/***********************************************************************************************
* Nonprofit Social Networking Platform: Allowing Users and Organizations to Collaborate.
* Copyright (C) 2023  ASCENDynamics NFP
*
* This file is part of Nonprofit Social Networking Platform.
*
* Nonprofit Social Networking Platform is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as published
* by the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.

* Nonprofit Social Networking Platform is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU Affero General Public License for more details.

* You should have received a copy of the GNU Affero General Public License
* along with Nonprofit Social Networking Platform.  If not, see <https://www.gnu.org/licenses/>.
***********************************************************************************************/
-->

<ion-card class="project-creation-card">
  <ion-card-header>
    <ion-card-title>
      <ion-icon name="add-circle" class="title-icon"></ion-icon>
      Add New Project
    </ion-card-title>
  </ion-card-header>

  <ion-card-content>
    <!-- Category Selection -->
    <app-category-selector
      [selectedCategory]="state.selectedCategory"
      (categoryChange)="onCategorySelected($event)"
      placeholder="Choose a category for your project"
    ></app-category-selector>

    <!-- Project Name Input -->
    <ion-item lines="none" class="project-name-input">
      <ion-label position="stacked">Project Name</ion-label>
      <ion-input
        placeholder="Enter your project name here (suggestions will appear)"
        [value]="state.newProjectName"
        (ionInput)="onProjectNameChange($event.detail.value || '')"
        (keyup.enter)="createProject()"
        clearInput="true"
      ></ion-input>
    </ion-item>

    <!-- Smart Category Suggestions -->
    <app-smart-category-suggestions
      [suggestions]="state.suggestedCategories"
      [visible]="state.showCategorySuggestions"
      (categorySelected)="onCategorySuggestionSelected($event)"
      (dismissed)="dismissCategorySuggestions()"
    ></app-smart-category-suggestions>

    <!-- Template Selection -->
    <div
      *ngIf="state.selectedCategory && state.availableTemplates.length > 0"
      class="template-selection"
    >
      <ion-label>
        <h4>Choose Template (Optional)</h4>
        <p>
          Select a template to pre-populate your project with common settings
        </p>
      </ion-label>

      <ion-radio-group [value]="state.selectedTemplate">
        <div class="templates-grid">
          <ion-item
            *ngFor="let template of state.availableTemplates"
            class="template-option"
            lines="none"
          >
            <ion-radio
              slot="start"
              [value]="template"
              (ionSelect)="onTemplateSelected(template)"
            ></ion-radio>

            <ion-label class="template-info">
              <h3>{{ template.name }}</h3>
              <p>{{ template.description }}</p>
              <div class="template-meta">
                <ion-chip color="light" size="small">
                  {{ template.complexity }}
                </ion-chip>
                <ion-chip color="light" size="small">
                  {{ template.estimatedTimeframe }}
                </ion-chip>
              </div>
            </ion-label>
          </ion-item>
        </div>
      </ion-radio-group>
    </div>

    <!-- Action Buttons -->
    <div class="add-project-actions" *ngIf="state.selectedCategory">
      <ion-button
        fill="clear"
        size="small"
        (click)="resetProjectCreation()"
        class="cancel-button"
      >
        Clear
      </ion-button>

      <!-- Bulk Create Toggle -->
      <ion-button
        fill="outline"
        size="small"
        (click)="toggleBulkCreate()"
        class="bulk-toggle-button"
      >
        <ion-icon
          [name]="state.bulkCreateProjects ? 'remove' : 'copy'"
          slot="start"
        ></ion-icon>
        {{ state.bulkCreateProjects ? "Single Project" : "Multiple Projects" }}
      </ion-button>

      <!-- Create Button -->
      <ion-button
        fill="solid"
        size="small"
        (click)="
          state.bulkCreateProjects ? createBulkProjects() : createProject()
        "
        [disabled]="
          state.bulkCreateProjects ? isBulkCreateDisabled : isCreateDisabled
        "
        class="create-button"
      >
        <ion-icon name="add" slot="start"></ion-icon>
        {{
          state.bulkCreateProjects
            ? "Create " + state.bulkCreateNames.length + " Projects"
            : "Create Project"
        }}
      </ion-button>
    </div>

    <!-- Bulk Creation Interface -->
    <div
      *ngIf="state.selectedCategory && state.bulkCreateProjects"
      class="bulk-create-section"
    >
      <ion-label>
        <h4>Multiple Project Creation</h4>
        <p>
          Create multiple projects at once with the same category and template
        </p>
      </ion-label>

      <div class="bulk-projects-list">
        <ion-item
          *ngFor="let name of state.bulkCreateNames; let i = index"
          lines="none"
          class="bulk-project-item"
        >
          <ion-label position="stacked">Project {{ i + 1 }} Name</ion-label>
          <ion-input
            [value]="name"
            (ionInput)="updateBulkProjectName(i, $event.detail.value || '')"
            placeholder="Enter project name"
            clearInput="true"
          ></ion-input>
          <ion-button
            *ngIf="state.bulkCreateNames.length > 1"
            fill="clear"
            size="small"
            slot="end"
            (click)="removeBulkCreateProject(i)"
          >
            <ion-icon name="trash" color="danger"></ion-icon>
          </ion-button>
        </ion-item>
      </div>

      <ion-button
        fill="outline"
        size="small"
        (click)="addBulkCreateProject()"
        class="add-bulk-project-btn"
      >
        <ion-icon name="add" slot="start"></ion-icon>
        Add Another Project
      </ion-button>
    </div>
  </ion-card-content>
</ion-card>
