<!--
Nonprofit Social Networking Platform: Allowing Users and Organizations to Collaborate.
Copyright (C) 2023  ASCENDynamics NFP

This file is part of Nonprofit Social Networking Platform.

Nonprofit Social Networking Platform is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published
by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Nonprofit Social Networking Platform is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with Nonprofit Social Networking Platform.  If not, see <https://www.gnu.org/licenses/>.
-->

<div class="map-container" [style.height]="height">
  <google-map
    [center]="center"
    [zoom]="zoom"
    [options]="mapOptions"
    width="100%"
    [height]="height"
    (idle)="onMapIdle()"
  >
    <!-- User location marker -->
    <map-marker
      *ngIf="userLocation"
      [position]="{lat: userLocation.latitude, lng: userLocation.longitude}"
      [options]="userMarkerOptions"
    ></map-marker>

    <!-- Info Window for selected listing -->
    <map-info-window #infoWindow>
      <div class="info-window" *ngIf="selectedListing">
        <div class="info-header">
          <img
            *ngIf="selectedListing.iconImage"
            [src]="selectedListing.iconImage"
            alt="Organization logo"
            class="info-logo"
          />
          <div class="info-titles">
            <h3 class="info-title">{{ selectedListing.title }}</h3>
            <p class="info-org">{{ selectedListing.organization }}</p>
          </div>
        </div>

        <div class="info-badges">
          <ion-badge [color]="getListingTypeColor(selectedListing.type)">
            {{ selectedListing.type | titlecase }}
          </ion-badge>
          <ion-badge *ngIf="selectedListing.remote" color="success">
            Remote
          </ion-badge>
        </div>

        <p class="info-description">
          {{ selectedListing.description | slice: 0 : 100 }}...
        </p>

        <div class="info-meta" *ngIf="selectedListing.timeCommitment">
          <ion-icon name="time-outline"></ion-icon>
          <span
            >{{ selectedListing.timeCommitment.hoursPerWeek }} hrs/week</span
          >
        </div>

        <ion-button
          fill="solid"
          size="small"
          expand="block"
          (click)="onViewDetails()"
        >
          View Details
        </ion-button>
      </div>
    </map-info-window>
  </google-map>

  <!-- No listings with location message -->
  <div
    class="no-locations-overlay"
    *ngIf="listings.length > 0 && listingMarkers.length === 0"
  >
    <ion-card>
      <ion-card-content>
        <ion-icon name="location-outline" color="medium"></ion-icon>
        <p>No listings have location data available.</p>
        <p class="hint">
          Listings need geocoded addresses to appear on the map.
        </p>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Empty state -->
  <div class="empty-overlay" *ngIf="listings.length === 0">
    <ion-card>
      <ion-card-content>
        <ion-icon name="map-outline" color="medium"></ion-icon>
        <p>No listings to display.</p>
      </ion-card-content>
    </ion-card>
  </div>
</div>
